import { u } from './chunk-354MYBEB.js';
import { h, j, k, g as g$1, i } from './chunk-E3TXESVT.js';
import { b, f, e, v, u as u$1, r, x, c as c$1 } from './chunk-6OTXFMWK.js';
import { b as b$2 } from './chunk-R4LN4DEY.js';
import { c, b as b$1, a } from './chunk-3AQ3E45C.js';
import { createContext, useContext, useRef, useState, useEffect } from 'react';
import { jsx } from 'react/jsx-runtime';
import { ContractPromise } from '@polkadot/api-contract';

var wt=(r,o)=>{r(e=>{let n=e.findIndex(({contractId:t,networkId:s})=>t.toLowerCase()===o.contractId.toLowerCase()&&s.toLowerCase()===o.networkId.toLowerCase());return n>=0&&e.splice(n,1),[...e,o]});},st=(r,o)=>c(void 0,null,function*(){(yield o).forEach(e=>wt(r,e));});var it=createContext(null),g=()=>{let r=useContext(it);if(!r)throw new Error("useInkathon must be used within a UseInkathonProvider");return r},Qt=({children:r,appName:o,defaultChain:e,connectOnInit:n,deployments:t,apiOptions:s,supportedWallets:h$1=h})=>{if(!e||typeof e=="string"&&u(e)===void 0)throw new Error("None or invalid `defaultChain` provided with `UseInkathonProvider`. Forgot to set environment variable?");let u$1=useRef(!1),d=useRef(!1),[p,f]=useState(n),[T,A]=useState(!1),[ft,U]=useState(),[W,mt]=useState(typeof e=="string"?u(e):e),[a$1,R]=useState(),[D,N]=useState(),[H,pt]=useState([]),[y,_]=useState(),[j$1,ht]=useState(),k$1=useRef(),x$1=useRef(),S=useRef(),[St,Pt]=useState([]);useEffect(()=>{t&&st(Pt,t);},[]);let q=i=>c(void 0,null,function*(){u$1.current=!0,A(!1),U(void 0);let m=i||W,l,P;try{(({api:l,provider:P}=yield x(m,a({noInitWarn:!0,throwOnConnect:!0},s)))),a$1==null||a$1.disconnect(),R(l),D==null||D.disconnect(),N(P),d.current=!0,W.network!==m.network&&mt(m);}catch(c){let b="Error while initializing Polkadot.js API";console.error(b,c),U({code:0,message:b}),A(!1),f(!1),R(void 0),N(void 0),d.current=!1;}return u$1.current=!1,l}),V=(i,m)=>{let l=i||[],P=m?{address:m}:j$1,c=l.find(b$1=>b(b$1,P))||(l==null?void 0:l[0]);c$1(H,l)||pt(()=>l),b(y,c)||_(()=>c),A(!!c);};useEffect(()=>{y&&!b(y,j$1)&&ht(()=>y);},[y]);let O=(i,m,l)=>c(void 0,null,function*(){var P;if(U(void 0),f(!0),A(!!y),!(a$1!=null&&a$1.isConnected)||i&&i.network!==W.network){let c=yield q(i);if(!(c!=null&&c.isConnected))return}try{let c=h$1.filter(w=>j(w));if(!(c!=null&&c.length)){let w="No Substrate-compatible extension detected";throw U({code:1,message:w}),new Error(w)}let gt=m&&c.find(w=>w.id===m.id)||c[0],v=yield k(gt,o);k$1.current=v,x$1.current=v==null?void 0:v.signer,(P=S.current)==null||P.call(S);let It=v==null?void 0:v.accounts.subscribe(w=>{V(w,l);});S.current=It;}catch(c){console.error("Error while connecting wallet:",c),k$1.current=void 0,x$1.current=void 0,A(!1);}finally{f(!1);}});useEffect(()=>{a$1==null||a$1.setSigner(x$1.current);},[a$1,x$1.current]);let J=i=>c(void 0,null,function*(){var m,l;if(i){yield D==null?void 0:D.disconnect(),yield a$1==null?void 0:a$1.disconnect();return}if(((m=k$1.current)==null?void 0:m.name)===g$1.id){let P=yield b$2(o);yield P==null?void 0:P.disconnect();}A(!1),V([]),(l=S.current)==null||l.call(S),S.current=void 0,k$1.current=void 0,x$1.current=void 0,d.current=!1;});useEffect(()=>{if(!a$1)return;let i=()=>{J();};return a$1==null||a$1.on("disconnected",i),()=>{a$1==null||a$1.off("disconnected",i);}},[a$1]),useEffect(()=>{if(!(d.current||u$1.current))return n?O():q(),()=>{var i;(i=S.current)==null||i.call(S);}},[]);let Ct=i$1=>c(void 0,null,function*(){let m=k$1.current&&i(k$1.current.name);yield O(i$1,m);});return jsx(it.Provider,{value:{isInitializing:u$1.current,isInitialized:d.current,isConnecting:p,isConnected:T,error:ft,activeChain:W,switchActiveChain:Ct,api:a$1,provider:D,connect:O,disconnect:J,accounts:H,activeAccount:y,activeExtension:k$1.current,activeSigner:x$1.current,setActiveAccount:_,lastActiveAccount:j$1,deployments:St,supportedWallets:h$1},children:r})};var oe=(r,o,e$1)=>{let{api:n}=g(),[t,s]=useState({tokenSymbol:"Unit",tokenDecimals:12}),[h,u]=useState([]);return useEffect(()=>{let d=p=>{s(()=>p);};if(!n){d({});return}return o?f(n,r,d,e$1).then(p=>{u(f=>[...f,p]);}):e(n,r,e$1).then(d),()=>{h.forEach(p=>p==null?void 0:p()),u(()=>[]);}},[n,r]),t};var ut=(r,o)=>{let{api:e,isConnecting:n}=g(),[t,s]=useState(),h=()=>c(void 0,null,function*(){if(n||!e||!r||!o){s(void 0);return}try{let u=new ContractPromise(e,r,o);s(u);}catch(u){console.error("Error during Contract initialization",u);}});return useEffect(()=>{h();},[e,n,r,o]),{contract:t,address:o}};var Pe=(r,o,e)=>{let{api:n,activeChain:t}=g(),[s,h]=useState([]),[u,d]=useState([]);return useEffect(()=>{let p=f=>{h(()=>f);};if(!n||!t){h([]);return}if(o){let f=v(n,r,p,t.network,e);f&&d(T=>[...T,f]);}else u$1(n,r,t.network,e).then(p);return ()=>{u.forEach(f=>f==null?void 0:f()),d(()=>[]);}},[n,r,t]),s};var dt=(r$1,o)=>{let{deployments:e,activeChain:n}=g();o=o||(n==null?void 0:n.network)||"";let t=r(e||[],r$1,o);return ut(t==null?void 0:t.abi,t==null?void 0:t.address)};var Ae=(r,o,e)=>{let{api:n,activeAccount:t}=g(),s=dt(r,e),[h,u]=useState(void 0);return useEffect(()=>{if(!(s!=null&&s.address)||!(t!=null&&t.address)||!n){u(void 0);return}let d=new o(s.address.toString(),t.address,n);u(d);},[s==null?void 0:s.address,t==null?void 0:t.address]),b$1(a({},s),{typedContract:h})};

export { wt as a, st as b, g as c, Qt as d, oe as e, ut as f, Pe as g, dt as h, Ae as i };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=chunk-AGPX5OVL.js.map